<div class="app-content d-flex justify-content-center align-items-center" style="height: 100vh">
    <mat-card class="container outline-card responsive-card w-40">
        <h2 class="d-flex justify-content-center">Register</h2>
        <div>
            <div [formGroup]="registrationForm" proxyMarkAllAsTouched (valid)="submit()">
                <ng-container
                    [ngTemplateOutlet]="formField"
                    [ngTemplateOutletContext]="{
                        key: 'user Name',
                        label: 'User Name',
                        required: true,
                        formControl: registrationForm.get('user.username')
                    }"
                ></ng-container>
                <div class="d-flex gap-3">
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            label: 'First Name',
                            patternError: 'Only alphabets are allowed',
                            formControl: registrationForm.get('user.fname')
                        }"
                    ></ng-container>
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            label: 'Last Name',
                            patternError: 'Only alphabets are allowed',
                            formControl: registrationForm.get('user.lname')
                        }"
                    ></ng-container>
                </div>
                <div class="d-flex gap-3">
                    <ng-container
                        [ngTemplateOutlet]="intlFormField"
                        [ngTemplateOutletContext]="{
                            key: 'user',
                            label: 'Mobile',
                            required: true,
                            formControl: registrationForm.get('user.mobile')
                        }"
                    ></ng-container>

                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            label: 'Email',
                            formControl: registrationForm.get('user.email')
                        }"
                    ></ng-container>
                </div>

                <div class="d-flex gap-3">
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            type: 'password',
                            label: 'Password',
                            patternError: 'Enter a valid password',
                            formControl: registrationForm.get('user.password')
                        }"
                    ></ng-container>
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            type: 'password',
                            label: 'Confirm Password',
                            patternError: 'Enter a valid password',
                            formControl: registrationForm.get('user.confirmPassword')
                        }"
                    ></ng-container>
                </div>

                <div class="mt-4 d-flex justify-content-center align-items-center">
                    <button mat-flat-button color="primary" style="width: 250px; font-size: 16px" (click)="submit()">
                        Submit
                    </button>
                </div>
            </div>
        </div>
    </mat-card>
</div>

<ng-template
    #formField
    let-type="type"
    let-label="label"
    let-hint="hint"
    let-formControl="formControl"
    let-patternError="patternError"
>
    <mat-form-field appearance="outline" style="width: 50%">
        <mat-label>{{ label }} </mat-label>
        <input
            matInput
            autocomplete="off"
            [attr.type]="type ?? 'text'"
            [formControl]="formControl"
            [placeholder]="'Enter ' + label"
        />
        <mat-error *ngIf="formControl.touched">
            <mat-error *ngIf="formControl.errors?.required"> {{ label }} is required. </mat-error>
            <mat-error *ngIf="formControl.errors?.minlengthWithSpace"> Min required length is 3 </mat-error>
            <mat-error *ngIf="formControl.errors?.noStartEndSpaces"> Start and End spaces are not allowed</mat-error>
            <mat-error *ngIf="formControl.errors?.min as minError">
                Min value required is {{ minError?.min }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.max as maxError">
                Max value allowed is {{ maxError?.max }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.minlength as minLengthError">
                Min required length is {{ minLengthError?.requiredLength }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.maxlength as maxLengthError">
                Max allowed length is {{ maxLengthError?.requiredLength }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.pattern">
                {{ patternError ? patternError : 'Enter valid ' + label }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.valueSameAsControl"> {{ label }} mismatch </mat-error>
        </mat-error>
        <mat-hint *ngIf="hint">{{ hint }}</mat-hint>
    </mat-form-field>
</ng-template>
<ng-template
    #intlFormField
    let-key="key"
    let-label="label"
    let-hint="hint"
    let-required="required"
    let-formControl="formControl"
>
    <div [attr.id]="'init-contact-wrapper-' + key" class="register-user-details">
        <input
            type="tel"
            class="w-100 mat-form-field"
            (keypress)="intlClass?.[key]?.onlyPhoneNumber($event) "
            [attr.id]="'init-contact-' + key"
            [placeholder]="'Enter ' + label"
            [ngClass]="{ 'invalid-input': formControl.touched && !intlClass?.[key]?.[required ? 'isRequiredValidNumber' : 'isValidNumber'] }"
            (blur)="formControl?.markAsTouched(); formControl?.setValue(intlClass?.[key]?.phoneNumber?.replace('+', ''))"
        />

        <div>
            <mat-error
                *ngIf="formControl.touched && !intlClass?.[key]?.[required ? 'isRequiredValidNumber' : 'isValidNumber']"
            >
                Please enter valid mobile number
            </mat-error>
        </div>
    </div>
</ng-template>
