<div style="height: 100vh; background-color: #fafafa">
    <mat-card
        class="h-75 container outline-card responsive-card py-5 --border-common-radius"
        style="box-shadow: rgba(0, 0, 0, 0.25) 0px 25px 50px -12px; background-color: #e6e6fa; width: 40%"
    >
        <h2 class="d-flex justify-content-center">Register</h2>
        <div style="margin-top: 50px">
            <div [formGroup]="registrationForm" proxyMarkAllAsTouched (valid)="submit()">
                <div class="d-flex gap-3 mt-20">
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            label: 'First Name',
                            patternError: 'Only alphabets are allowed',
                            formControl: registrationForm.get('user.fname')
                        }"
                    ></ng-container>
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            label: 'Last Name',
                            patternError: 'Only alphabets are allowed',
                            formControl: registrationForm.get('user.lname')
                        }"
                    ></ng-container>
                </div>
                <div class="d-flex gap-5 mat-form-field mt-20">
                    <ng-container
                        [ngTemplateOutlet]="intlFormField"
                        [ngTemplateOutletContext]="{
                            key: 'user',
                            label: 'Mobile',
                            required: true,
                            formControl: registrationForm.get('user.mobile')
                        }"
                    ></ng-container>

                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            label: 'Email',
                            formControl: registrationForm.get('user.email')
                        }"
                    ></ng-container>
                </div>
                <div class="d-flex gap-3 mt-20 w-auto">
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            key: 'user Name',
                            label: 'User Name',
                            required: true,
                            formControl: registrationForm.get('user.username')
                        }"
                    ></ng-container>
                </div>

                <div class="d-flex gap-3 mt-30">
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            type: 'password',
                            label: 'Password',
                            patternError: 'Enter a valid password',
                            formControl: registrationForm.get('user.password')
                        }"
                    ></ng-container>
                    <ng-container
                        [ngTemplateOutlet]="formField"
                        [ngTemplateOutletContext]="{
                            type: 'password',
                            label: 'Confirm Password',
                            patternError: 'Enter a valid password',
                            formControl: registrationForm.get('user.confirmPassword')
                        }"
                    ></ng-container>
                </div>

                <div class="mt-30 d-flex justify-content-center align-items-center gap-3">
                    <button
                        mat-flat-button
                        color="primary"
                        style="height: 40px; width: 250px; font-size: 16px"
                        (click)="submit()"
                    >
                        Submit
                    </button>
                </div>
            </div>
        </div>
    </mat-card>
</div>

<ng-template
    #formField
    let-type="type"
    let-label="label"
    let-hint="hint"
    let-formControl="formControl"
    let-patternError="patternError"
>
    <mat-form-field appearance="outline" style="width: 100%">
        <mat-label>{{ label }} </mat-label>
        <input
            matInput
            autocomplete="off"
            [attr.type]="type ?? 'text'"
            [formControl]="formControl"
            [placeholder]="'Enter ' + label"
        />
        <mat-error *ngIf="formControl.touched">
            <mat-error *ngIf="formControl.errors?.required"> {{ label }} is required. </mat-error>
            <mat-error *ngIf="formControl.errors?.minlengthWithSpace"> Min required length is 3 </mat-error>
            <mat-error *ngIf="formControl.errors?.noStartEndSpaces"> Start and End spaces are not allowed</mat-error>
            <mat-error *ngIf="formControl.errors?.min as minError">
                Min value required is {{ minError?.min }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.max as maxError">
                Max value allowed is {{ maxError?.max }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.minlength as minLengthError">
                Min required length is {{ minLengthError?.requiredLength }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.maxlength as maxLengthError">
                Max allowed length is {{ maxLengthError?.requiredLength }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.pattern">
                {{ patternError ? patternError : 'Enter valid ' + label }}
            </mat-error>
            <mat-error *ngIf="formControl.errors?.valueSameAsControl"> {{ label }} mismatch </mat-error>
        </mat-error>
        <mat-hint *ngIf="hint">{{ hint }}</mat-hint>
    </mat-form-field>
</ng-template>
<ng-template
    #intlFormField
    let-key="key"
    let-label="label"
    let-hint="hint"
    let-required="required"
    let-formControl="formControl"
>
    <div [attr.id]="'init-contact-wrapper-' + key" class="register-user-details">
        <div style="width: 340px; margin-top: 4px">
            <input
                type="tel"
                style="display: flex; width: 175%; height: 40px; border: 1px solid rgb(216, 210, 210)"
                (keypress)="intlClass?.[key]?.onlyPhoneNumber($event) "
                [attr.id]="'init-contact-' + key"
                [placeholder]="'Enter ' + label + (required ? ' *' : '')"
                [ngClass]="{ 'invalid-input': formControl.touched && !intlClass?.[key]?.[required ? 'isRequiredValidNumber' : 'isValidNumber'] }"
                (blur)="formControl?.markAsTouched(); formControl?.setValue(intlClass?.[key]?.phoneNumber?.replace('+', ''))"
            />
        </div>

        <div>
            <mat-error
                *ngIf="formControl.touched && !intlClass?.[key]?.[required ? 'isRequiredValidNumber' : 'isValidNumber']"
            >
                Please enter valid mobile number
            </mat-error>
        </div>
    </div>
</ng-template>
