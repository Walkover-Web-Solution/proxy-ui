<div class="app-content">
    <div class="d-flex align-items-center justify-content-between gap-3 mb-3">
        <div class="d-flex align-items-center justify-content-between gap-3">
            <mat-form-field appearance="outline" class="no-padding">
                <mat-label>Select Project</mat-label>
                <mat-select class="Select Project" (selectionChange)="selectEnvProject($event)">
                    <mat-option [value]="''">None</mat-option>
                    <mat-option *ngFor="let project of (envProjects$ | async)?.data" [value]="project.slug">
                        {{ project.project_name }}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <proxy-lib-search
                [matFormFieldClass]="'no-padding'"
                [placeholder]="'Search'"
                (inputChanges)="onEnter($event)"
                class="w-xs-100"
            ></proxy-lib-search>
        </div>
        <div class="d-flex align-items-center justify-content-between gap-3">
            <date-range-picker
                (selectedRangeValueChange)="setDateRange($event)"
                [(selectedRangeValue)]="selectedRangeValue"
                [selectedDefaultDateRange]="selectedDefaultDateRange.CurrentMonth"
            ></date-range-picker>
            <button mat-flat-button class="flat-default" [matMenuTriggerFor]="emailExportButtonMenu">
                <mat-icon class="mat-icon-prefix mat-icon-18 material-icons-outlined">filter_alt</mat-icon> Filter
            </button>
            <mat-menu #emailExportButtonMenu="matMenu" class="filter-menu" xPosition="before">
                <div (click)="$event.stopPropagation(); (false)">
                    <div class="pb-0 pt-3 px-3">
                        <div class="row" [formGroup]="logsFilterForm">
                            <div class="col-lg-12">
                                <!-- <date-range-picker
                                    class="d-flex mb-3"
                                    (selectedRangeValueChange)="setDateRange($event)"
                                    [(selectedRangeValue)]="selectedRangeValue"
                                    [selectedDefaultDateRange]="selectedDefaultDateRange.CurrentMonth"
                                ></date-range-picker> -->
                                <mat-form-field appearance="outline" floatLabel="always" class="w-100">
                                    <mat-label>Select request type</mat-label>
                                    <mat-select
                                        placeholder="Select request types"
                                        [disableOptionCentering]="true"
                                        formControlName="requestType"
                                        multiple
                                    >
                                        <mat-checkbox
                                            class="mat-option w-100"
                                            [disableRipple]="true"
                                            [indeterminate]="
                                                logsFilterForm.controls.requestType.value.length > 0 &&
                                                requestTypes.length > logsFilterForm.controls.requestType.value.length
                                            "
                                            [checked]="
                                                requestTypes.length === logsFilterForm.controls.requestType.value.length
                                            "
                                            (click)="$event.stopPropagation()"
                                            (change)="toggleSelectAll($event)"
                                        >
                                            All
                                        </mat-checkbox>
                                        <mat-option [value]="type" *ngFor="let type of requestTypes">{{
                                            type
                                        }}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field appearance="outline" floatLabel="always" class="w-100">
                                    <mat-label>Select range type</mat-label>
                                    <mat-select
                                        placeholder="Select range type"
                                        [disableOptionCentering]="true"
                                        formControlName="range"
                                        (selectionChange)="changeRangeType($event.value)"
                                    >
                                        <mat-option [value]="''">None</mat-option>
                                        <mat-option [value]="'response_time'">Response Time</mat-option>
                                        <mat-option [value]="'status_code'">Status Code</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <div class="col-lg-6 pr-2">
                                <mat-form-field appearance="outline" class="w-100" floatLabel="always">
                                    <mat-label>From</mat-label>
                                    <input
                                        matInput
                                        placeholder="From"
                                        autocomplete="off"
                                        formControlName="from"
                                        msg91RemoveCharacter
                                        />
                                        <!-- [charactersToRemove]="['e', '+', '-', '.', ' ']" -->
                                    <mat-error *ngIf="logsFilterForm.controls.from.invalid">
                                        <mat-error *ngIf="logsFilterForm.get('from').errors?.pattern"
                                            >Invalid Number</mat-error
                                        >
                                        <mat-error
                                            *ngIf="logsFilterForm.get('from').errors?.maxlength as maxlengthError"
                                        >
                                            Max {{ maxlengthError.requiredLength }} number are allowed
                                        </mat-error>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                            <div class="col-lg-6 pl-2">
                                <mat-form-field appearance="outline" class="w-100" floatLabel="always">
                                    <mat-label>To</mat-label>
                                    <input
                                        matInput
                                        placeholder="To"
                                        autocomplete="off"
                                        formControlName="to"
                                        msg91RemoveCharacter
                                        />
                                        <!-- [charactersToRemove]="['e', '+', '-', '.', ' ']" -->
                                    <mat-error *ngIf="logsFilterForm.controls.to.invalid">
                                        <mat-error *ngIf="logsFilterForm.get('to').errors?.pattern"
                                            >Invalid Number</mat-error
                                        >
                                        <mat-error *ngIf="logsFilterForm.get('to').errors?.maxlength as maxlengthError">
                                            Max {{ maxlengthError.requiredLength }} number are allowed
                                        </mat-error>
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <mat-divider></mat-divider>
                    <div class="d-flex align-items-center col-gap-3 action-button p-3">
                        <button
                            mat-flat-button
                            color="primary"
                            (click)="applyFilter()"
                            [disabled]="logsFilterForm.invalid"
                        >
                            Apply
                        </button>
                        <button mat-flat-button class="flat-default" (click)="resetParam()">Reset</button>
                        <button mat-button (click)="closeMyMenu()">Cancel</button>
                    </div>
                </div>
            </mat-menu>
        </div>
    </div>
    <mat-card class="p-0 outline-card overflow-hidden">
        <mat-card-content>
            <div class="table-scroll">
                <table mat-table [dataSource]="(logs$ | async)?.data" class="default-table" matSort (matSortChange)="sortLogs($event)">
                    <!-- Time Column -->
                    <ng-container matColumnDef="created_at">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Time</th>
                        <td mat-cell *matCellDef="let element">{{ element.created_at }}</td>
                    </ng-container>

                    <!-- Endpoint Column -->
                    <ng-container matColumnDef="endpoint">
                        <th mat-header-cell *matHeaderCellDef>Endpoint</th>
                        <td mat-cell *matCellDef="let element">{{ element.endpoint }}</td>
                    </ng-container>

                    <!-- Request Type Column -->
                    <ng-container matColumnDef="request_type">
                        <th mat-header-cell *matHeaderCellDef>Request type</th>
                        <td mat-cell *matCellDef="let element">{{ element.request_type }}</td>
                    </ng-container>

                    <!-- Status Code Column -->
                    <ng-container matColumnDef="status_code">
                        <th mat-header-cell *matHeaderCellDef>Status code</th>
                        <td mat-cell *matCellDef="let element">{{ element.status_code }}</td>
                    </ng-container>

                    <!-- Response Time Column -->
                    <ng-container matColumnDef="response_time">
                        <th mat-header-cell *matHeaderCellDef mat-sort-header>Response time</th>
                        <td mat-cell *matCellDef="let element">{{ element.response_time_in_ms }}</td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

                    <tr *matNoDataRow>
                        <td class="mat-cell border-none" [attr.colspan]="displayedColumns.length">
                            <msg91-no-record-found
                                [title]="'proxy logs'"
                                [showBtn]="false"
                            ></msg91-no-record-found>
                        </td>
                    </tr>
                </table>
            </div>
            <mat-paginator-goto
                [length]="(logs$ | async)?.totalEntityCount"
                [pageSize]="params?.itemsPerPage"
                [pageSizeOptions]="pageSizeOptions"
                (page)="pageChange($event)"
                [pageIndex]="params?.pageNo - 1"
                class="box-shadow-none"
            ></mat-paginator-goto>
        </mat-card-content>
    </mat-card>
</div>
