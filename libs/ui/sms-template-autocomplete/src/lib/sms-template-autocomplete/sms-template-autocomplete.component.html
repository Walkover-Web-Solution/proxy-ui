<div class="d-flex col-gap-3 align-items-start">
    <mat-form-field [appearance]="appearance" class="w-100" [floatLabel]="fromCampaign ? 'auto' : 'always'">
        <mat-label>Select template</mat-label>
        <input
            type="text"
            matInput
            [matAutocomplete]="smsTemplateAutoComplete"
            #smsTemplateInput
            [formControl]="smsTemplateFormControl"
            placeholder=" Select Template"
            (focusout)="
                $event?.relatedTarget?.nodeName !== 'MAT-OPTION' && $event?.relatedTarget?.nodeName !== 'A'
                    ? autocomplete.closePanel()
                    : null
            "
        />
        <mat-autocomplete
            #smsTemplateAutoComplete="matAutocomplete"
            (optionSelected)="selectTemplate()"
            [displayWith]="templateDisplayFunction"
            msg91AutoSelectDropdown
            (setControlValue)="setSmsControlValue($event)"
        >
            <msg91-cdk-scroll (fetchNextPage)="fetchNextTemplatePage($event)" [scrollableElementId]="smsTempID">
                <cdk-virtual-scroll-viewport
                    itemSize="40"
                    minBufferPx="256"
                    maxBufferPx="256"
                    style="height: 256px; width: 100%"
                    [attr.id]="smsTempID"
                    *ngIf="templates.length > 4; else noScroll"
                >
                    <a
                        class="flat-primary-light my-2 mx-3"
                        mat-flat-button
                        href="javascript:void(0)"
                        (click)="openCreateTemplate.emit(); autocomplete.closePanel()"
                        >Create {{ isOTP ? 'OTP' : 'SMS' }} Template</a
                    >
                    <mat-option [value]="temp" *ngFor="let temp of templates">
                        {{ temp.name || temp.template_name }}
                    </mat-option>
                </cdk-virtual-scroll-viewport>
                <ng-template #noScroll>
                    <a
                        class="flat-primary-light my-2 mx-3"
                        mat-flat-button
                        href="javascript:void(0)"
                        (click)="openCreateTemplate.emit(); autocomplete.closePanel()"
                        >Create {{ isOTP ? 'OTP' : 'SMS' }} Template</a
                    >
                    <!-- <mat-option value="">-- Select template --</mat-option> -->
                    <mat-option disabled value="" *ngIf="!templates?.length"> No Template Found </mat-option>
                    <mat-option [value]="temp" *ngFor="let temp of templates">
                        {{ temp.name || temp.template_name }}
                    </mat-option>
                </ng-template>
            </msg91-cdk-scroll>
        </mat-autocomplete>
        <button
            mat-icon-button
            matSuffix
            *ngIf="showCloseTemplate"
            class="cursor-pointer icon-btn-md"
            color="primary"
            (click)="clearTemplate()"
        >
            <mat-icon class="mat-icon-20 text-dark">close</mat-icon>
        </button>
        <mat-error *ngIf="smsTemplateFormControl.touched">
            <mat-error *ngIf="smsTemplateFormControl.errors?.required"> Template field is required. </mat-error>
            <mat-error *ngIf="smsTemplateFormControl.errors?.elementExistsInList">
                Select Template from dropdown
            </mat-error>
        </mat-error>
    </mat-form-field>
    <button
        type="button"
        mat-flat-button
        class="flat-icon-btn flat-default mt-1"
        (click)="refreshTemplate()"
        matTooltip="Refresh"
        matTooltipPosition="above"
    >
        <mat-icon class="mat-icon-18">refresh</mat-icon>
    </button>
</div>
