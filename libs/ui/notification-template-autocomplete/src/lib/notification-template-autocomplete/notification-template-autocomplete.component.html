<div class="d-flex align-items-start">
    <mat-form-field [appearance]="appearance" class="w-100 whatsapp-compose">
        <mat-label>Select template</mat-label>
        <input
            type="text"
            matInput
            [matAutocomplete]="templateAutoComplete"
            #templateInput
            [formControl]="templateForm"
            placeholder=" Select template"
            (focusout)="
                $event?.relatedTarget?.nodeName !== 'MAT-OPTION' && $event?.relatedTarget?.nodeName !== 'A'
                    ? autocomplete.closePanel()
                    : null
            "
        />
        <mat-autocomplete #templateAutoComplete="matAutocomplete">
            <msg91-cdk-scroll (fetchNextPage)="fetchNextTemplatePage()">
                <a
                    mat-flat-button
                    class="flat-primary-light my-2 mx-3"
                    href="javascript:void(0);"
                    (click)="createNewTemplate.emit()"
                    ><mat-icon class="mat-icon-18 mat-icon-prefix mr-1">add</mat-icon>Create Template</a
                >
                <mat-option disabled value="" *ngIf="!(templates$ | async)?.length"> No Template Found </mat-option>
                <mat-option [value]="temp.name" *ngFor="let temp of templates$ | async">
                    {{ temp.name }}
                </mat-option>
            </msg91-cdk-scroll>
        </mat-autocomplete>
        <button
            mat-icon-button
            matSuffix
            *ngIf="templateInput?.value"
            class="icon-btn-md"
            (click)="templateForm.reset(); refetchTemplates()"
            color="primary"
        >
            <mat-icon class="mat-icon-20">close</mat-icon>
        </button>
        <mat-error *ngIf="templateForm.touched && templateForm.errors?.required"> Template is required. </mat-error>
        <mat-error *ngIf="templateForm.touched && templateForm.errors?.elementExistsInList">
            Select Template from dropdown.
        </mat-error>
    </mat-form-field>
    <button
        type="button"
        mat-flat-button
        class="flat-icon-btn my-1 ml-2 flat-default"
        (click)="fetchTemplate(templateParams, true)"
        matTooltip="Refresh"
        matTooltipPosition="above"
    >
        <mat-icon class="mat-icon-18">refresh</mat-icon>
    </button>
</div>
